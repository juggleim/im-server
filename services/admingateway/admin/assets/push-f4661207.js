import{_ as b}from"./form-49cbda38.js";import{B as s,c as l,a as d,F as v,b as h,u as y,i as w,A as r,d as o,R as S,o as i,p as g,t as A,h as C,g as E}from"./index-fb0c9453.js";const P={class:"md-4"},I={class:"nav nav-underline-border",role:"tablist"},$=["onClick"],O={class:"tab-content rounded-bottom"},B={class:"row jg-sw-row"},q={__name:"push",setup(R){let k=w(),{currentRoute:{_rawValue:{params:{app_key:n}}}}=k;const u=E();let c=[{type:"Huawei",name:"华为",state:s({package:"",app_id:"",app_secret:""}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"app_id",label:"App Id",type:"input_text"},{name:"app_secret",label:"App Secret",type:"input_text"}]},{type:"Xiaomi",name:"小米",state:s({package:"",app_secret:""}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"app_secret",label:"App Secret",type:"input_text"}]},{type:"Oppo",name:"OPPO",state:s({package:"",app_key:"",master_secret:""}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"app_key",label:"App Key",type:"input_text"},{name:"master_secret",label:"Master Secret",type:"input_text"}]},{type:"Vivo",name:"vivo",state:s({package:"",app_id:"",app_key:"",app_secret:""}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"app_id",label:"App Id",type:"input_text"},{name:"app_key",label:"App Key",type:"input_text"},{name:"app_secret",label:"App Secret",type:"input_text"}]},{type:"ios",name:"iOS",state:s({package:"",cert_path:"",cert_pwd:"",is_product:0}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"cert_path",label:"证书文件",type:"file"},{name:"cert_pwd",label:"证书密码",type:"input_text"},{name:"is_product",label:"证书环境",type:"radios",radios:[{name:"type",value:0,label:"开发环境"},{name:"type",value:1,label:"生产环境"}]}]}];const p=s(c[0].type);function m(e){p.value=e.type,f()}function x(e){if(p.value.startsWith("ios")){let{file:t}=e;if(!t.name)return r.setIosPushConfig({app_key:n,package:e.package,cert_pwd:e.cert_pwd,is_product:e.is_product}).then(()=>{u.proxy.$toast({icon:"success",text:"保存成功"})});r.uploadIosPushConfig({app_key:n,package:e.package,cert_pwd:e.cert_pwd,file:e.file,is_product:e.is_product}).then(()=>{u.proxy.$toast({icon:"success",text:"保存成功"})})}else r.setAndroidPushConfig({app_key:n,push_channel:p.value,package:e.package,extra:e}).then(()=>{u.proxy.$toast({icon:"success",text:"保存成功"})})}async function f(){if(p.value.startsWith("ios")){const e=await r.getIosPushConfig({app_key:n,push_channel:p.value});let{data:t}=e;t||(t={is_product:0}),o.forEach(c,a=>{a.type===p.value&&(a.state.value={...a.state.value,package:t.package,cert_path:t.cert_path,cert_pwd:t.cert_pwd,is_product:t.is_product})})}else{const e=await r.getAndroidPushConfig({app_key:n,push_channel:p.value});let{code:t,data:a={}}=e;if(!o.isEqual(t,S.SUCCESS))return u.proxy.$toast({icon:"error",text:"查询异常，请刷新重试"});o.forEach(c,_=>{_.type===p.value&&(_.state.value={..._.state.value,package:a.package,...a.extra})})}}return f(),(e,t)=>(i(),l("div",P,[d("ul",I,[(i(!0),l(v,null,h(y(c),a=>(i(),l("li",{class:"nav-item sw-nav-item",onClick:_=>m(a)},[d("a",{class:g(["nav-link jgicon jgicon-free",{active:y(o).isEqual(p.value,a.type)}])},A(a.name),3)],8,$))),256))]),d("div",O,[(i(!0),l(v,null,h(y(c),a=>(i(),l("div",{class:g(["tab-pane p-3",{active:y(o).isEqual(p.value,a.type)}])},[d("div",B,[C(b,{fields:a.fields,state:a.state.value,onSave:x},null,8,["fields","state"])])],2))),256))])]))}};export{q as default};
