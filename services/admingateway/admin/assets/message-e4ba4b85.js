import{r as V,a6 as T,V as E,s as R,c as f,a as r,h as m,u as l,F as N,b as P,w as S,i as U,d as c,C as B,o as w,p as F,t as v,a7 as I,g as O}from"./index-a6509667.js";import{_ as C,c as u,A as $}from"./analysis-day-d980516b.js";const G={class:"mb-4 jg-as-box"},Y={class:"row jg-cb-row jg-as-header"},q={class:"jg-bk-form"},z={class:"row jg-asr-row"},L={class:"jg-as-tools"},W={class:"jg-as-tool"},H=["onClick"],J={class:"jg-as-date jgicon jgicon-date"},K=["onClick"],Q={class:"row jg-as-body"},X={class:"jg-bk-form",ref:"asuserchat"},se={__name:"message",setup(Z){const M=O();let k=U(),{currentRoute:{_rawValue:{params:{app_key:g}}}}=k,a=V({buttons:T,range:{start:new Date(Date.now()-7*24*60*60*1e3),end:new Date},yestday:{upMsg:{percent:0,isUp:!0,count:0},downMsg:{percent:0,isUp:!0,count:0},disMsg:{percent:0,isUp:!0,count:0}}}),p=null;function _(t){if(!p){let{asuserchat:d}=M.refs;p=M.proxy.$echat.init(d)}let{upMsgs:s,downMsgs:o,disMsgs:e,dates:i}=u.formatChatData(t);const n=["#5470C6","#008000","#EE6666"];let h={legend:{data:["单聊上行消息量","单聊下行消息量","单聊分发消息量"]},tooltip:{trigger:"none",axisPointer:{type:"cross"}},xAxis:{type:"category",boundaryGap:!1,data:i},yAxis:{type:"value",axisPointer:{label:{formatter:function(d){return c.numberWithCommas(d.value.toFixed(0))}}}},series:[{name:"单聊上行消息量",type:"line",smooth:!0,data:s,lineStyle:{color:n[0]}},{name:"单聊下行消息量",type:"line",smooth:!0,lineStyle:{color:n[1]},data:o},{name:"单聊分发消息量",type:"line",smooth:!0,lineStyle:{color:n[2]},data:e}]};p.setOption(h)}async function y(t){let{data:s}=await $.getMessageChat({...t,channel_type:I.PRIVATE}),{msg_dispatch:o={items:[]},msg_down:e={items:[]},msg_up:i={items:[]}}=s,n=(D,A)=>D.time_mark>A.time_mark,h=c.sort(o.items,n),d=c.sort(e.items,n),x=c.sort(i.items,n);return{disMsgs:h,downMsgs:d,upMsgs:x}}function j(t){return c.formatTime(new Date(t).getTime(),"yyyy-MM-dd")}async function b(t){c.map(a.buttons,n=>(n.isActive=c.isEqual(n.name,t.name),n));let{start:s,end:o}=u.getRangeDate(t.name),i=await y({app_key:g,start:s,end:o});_(i)}return E(()=>{let{start:t,end:s}=u.getRangeDate(7);y({app_key:g,start:t,end:s}).then(e=>{let i=u.calcYesterday(e);c.extend(a.yestday,i),_(e)})}),R(()=>a.range,async()=>{let{start:t,end:s}=a.range;t=new Date(t).getTime(),s=new Date(s).getTime();let e=await y({app_key:g,start:t,end:s});_(e)}),(t,s)=>{const o=B("VDatePicker");return w(),f("div",G,[r("div",Y,[r("div",q,[r("div",z,[m(C,{title:"昨日单聊上行消息量（条）",item:l(a).yestday.upMsg},null,8,["item"]),m(C,{title:"昨日单聊下行消息量（条）",item:l(a).yestday.downMsg},null,8,["item"]),m(C,{title:"昨日单聊分发消息量（条）",item:l(a).yestday.disMsg},null,8,["item"])])])]),r("div",L,[r("div",W,[(w(!0),f(N,null,P(l(a).buttons,e=>(w(),f("div",{class:F(["jg-as-button",{"jg-as-button-active":e.isActive}]),onClick:i=>b(e)},v(e.title),11,H))),256)),r("div",J,[m(o,{modelValue:l(a).range,"onUpdate:modelValue":s[0]||(s[0]=e=>l(a).range=e),modelModifiers:{range:!0},class:"jg-as-date-picker"},{default:S(({togglePopover:e})=>[r("div",{class:"jg-as-date-content",onClick:e},v(j(l(a).range.start))+" 至 "+v(j(l(a).range.end)),9,K)]),_:1},8,["modelValue"])])])]),r("div",Q,[r("div",X,null,512)])])}}};export{se as default};
