import{r as C,ac as D,n as b,z as k,c as f,b as r,F as A,d as T,u as c,k as V,w as E,l as R,H as N,o as g,x as P,t as h,ad as F,e as i,h as S}from"./index-668b837b.js";import{c as y,A as B}from"./common-15833b08.js";const I={class:"mb-4 cim-as-box"},M={class:"cim-as-tools"},O={class:"cim-as-tool"},U=["onClick"],$={class:"cim-as-date cicon cicon-date"},q=["onClick"],z={class:"row cim-as-body"},G={class:"cim-bk-form",ref:"asuserchat"},Y={__name:"user",setup(W){const u=S();let w=R(),{currentRoute:{_rawValue:{params:{app_key:m}}}}=w,o=C({buttons:D,range:{start:new Date(Date.now()-8*24*60*60*1e3),end:new Date(Date.now()-1*24*60*60*1e3)}}),d=null;function p(e){if(!d){let{asuserchat:n}=u.refs;d=u.proxy.$echat.init(n)}let{daus:a,dates:s}=y.formatDauChat(e),l={legend:{data:["日活"]},tooltip:{trigger:"none",axisPointer:{type:"cross"}},xAxis:{type:"category",boundaryGap:!1,data:s},yAxis:{type:"value",axisPointer:{label:{formatter:function(n){return i.numberWithCommas(n.value.toFixed(0))}}}},series:[{name:"日活",type:"line",smooth:!0,data:a,lineStyle:{color:["#5470C6"][0]},label:{show:!0,position:"top",formatter:function(n){return i.numberWithCommas(n.value.toFixed(0))}}}]};d.setOption(l)}async function _(e){let{data:a,code:s}=await B.getUserChat({...e,channel_type:F.PRIVATE});if(i.isEqual(s,0)){let{items:t}=a;return{items:t}}return u.proxy.$toast({icon:"error",text:"日活统计失败，请刷新重试"}),{items:[]}}function v(e){return i.formatTime(new Date(e).getTime(),"yyyy-MM-dd")}async function x(e){i.map(o.buttons,n=>(n.isActive=i.isEqual(n.name,e.name),n));let{start:a,end:s}=y.getRangeDate(e.name),l=await _({app_key:m,start:a,end:s});p(l)}return b(()=>{let{start:e,end:a}=y.getRangeDate(8);_({app_key:m,start:e,end:a}).then(t=>{p(t)})}),k(()=>o.range,async()=>{let{start:e,end:a}=o.range;e=new Date(e).getTime(),a=new Date(a).getTime();let t=await _({app_key:m,start:e,end:a});p(t)}),(e,a)=>{const s=N("VDatePicker");return g(),f("div",I,[r("div",M,[r("div",O,[(g(!0),f(A,null,T(c(o).buttons,t=>(g(),f("div",{class:P(["cim-as-button",{"cim-as-button-active":t.isActive}]),onClick:l=>x(t)},h(t.title),11,U))),256)),r("div",$,[V(s,{modelValue:c(o).range,"onUpdate:modelValue":a[0]||(a[0]=t=>c(o).range=t),modelModifiers:{range:!0},class:"cim-as-date-picker"},{default:E(({togglePopover:t})=>[r("div",{class:"cim-as-date-content",onClick:t},h(v(c(o).range.start))+" 至 "+h(v(c(o).range.end)),9,q)]),_:1},8,["modelValue"])])])]),r("div",z,[r("div",G,null,512)])])}}};export{Y as default};
