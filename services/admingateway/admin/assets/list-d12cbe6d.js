import{P as M,O as A,a3 as at,d as n,r as G,C as I,o as u,z as lt,w as P,a as t,j as x,x as nt,u as o,c as p,b as q,t as d,F as B,h as V,v as S,g as F,$ as N,k as T,i as rt,R as U,a4 as O,p as it,a5 as R}from"./index-a6509667.js";import{_ as dt}from"./dialog-70b70e8a.js";function ct(h){let{limit:j=15,offset:y=1,app_key:m,user_id:v,start:e,end:g,description:b}=h,w=`${M.LOG_GET_LIST}?app_key=${m}&user_id=${v}&limit=${j}&offset=${y}&start=${e}&end=${g}&description=${b}`;return A(w,{method:"GET"})}function ut(h){let{app_key:j,id:y}=h,m=`${M.LOG_DOWNLOAD}?app_key=${j}&id=${y}`;return at(m,{method:"GET"})}function mt(h){return A(M.LOG_CREATE_PULL,{method:"POST",body:n.toJSON(h)})}const L={getList:ct,create:mt,download:ut},gt={class:"row g-2 jg-row jg-dialog-pull-row"},pt={class:"form-floating"},ft=["value"],_t={class:"form-floating jg-dialog-pull-datetime"},ht=["onClick"],jt={class:"form-floating jg-from-must jgicon jgicon-must"},yt={class:"form-floating jg-from-must jgicon jgicon-must"},vt={__name:"dialog-pull-log",props:["title","text"],emits:["save","hide"],setup(h,{emit:j}){const y=F(),m=h,v=j;let e=G({params:{user_id:"",description:"",platform:"android"},range:{start:new Date(Date.now()-1*24*60*60*1e3),end:new Date},times:[{value:"1"}],categories:[{name:"业务日志",value:1}],platforms:[{name:"Android",value:"android"},{name:"iOS",value:"ios"},{name:"Web",value:"web"},{name:"PC",value:"pc"}]});function g(){let{user_id:f,description:l}=e.params;if(n.isEqual(f.length,0))return y.proxy.$toast({icon:"error",text:"用户 ID 不可为空"});if(n.isEqual(l.length,0))return y.proxy.$toast({icon:"error",text:"备注 不可为空"});let $=n.clone(e.params),{start:r,end:k}=e.range;v("save",{...$,start:r.getTime(),end:k.getTime()})}function b(f){v("hide",{})}function w(f){return n.formatTime(new Date(f).getTime(),"yyyy-MM-dd hh:mm")}return(f,l)=>{const $=I("VDatePicker");return u(),lt(dt,{title:m.title,"btn-title":m.text,cls:"jg-pull-dialog",onHide:b,onSave:g},{default:P(()=>[t("div",gt,[t("div",pt,[x(t("select",{class:"form-select","onUpdate:modelValue":l[0]||(l[0]=r=>o(e).params.platform=r)},[(u(!0),p(B,null,q(o(e).platforms,r=>(u(),p("option",{value:r.value},d(r.name),9,ft))),256))],512),[[nt,o(e).params.platform]]),l[4]||(l[4]=t("label",null,"平台",-1))]),t("div",_t,[V($,{modelValue:o(e).range,"onUpdate:modelValue":l[1]||(l[1]=r=>o(e).range=r),modelModifiers:{range:!0},mode:"dateTime",is24hr:""},{default:P(({togglePopover:r})=>[t("div",{class:"form-control jg-as-date-content",onClick:r},d(w(o(e).range.start))+" 至 "+d(w(o(e).range.end)),9,ht)]),_:1},8,["modelValue"]),l[5]||(l[5]=t("label",null,"时间范围",-1))]),t("div",jt,[x(t("input",{class:"form-control",placeholder:"用户 ID","onUpdate:modelValue":l[2]||(l[2]=r=>o(e).params.user_id=r)},null,512),[[S,o(e).params.user_id]]),l[6]||(l[6]=t("label",null,"用户 ID ",-1))]),t("div",yt,[x(t("input",{class:"form-control",placeholder:"备注说明","onUpdate:modelValue":l[3]||(l[3]=r=>o(e).params.description=r)},null,512),[[S,o(e).params.description]]),l[7]||(l[7]=t("label",null,"备注说明",-1))])])]),_:1},8,["title","btn-title"])}}},bt={class:"mb-4 jg-log-contanier"},kt={class:"jg-log-header"},wt={class:"jg-log-header-lf-box"},$t={class:"jg-log-lf-item"},xt=["onClick"],Dt={class:"jg-log-lf-item"},St={class:"jg-log-lf-item"},Ct={class:"jg-log-header-rg-box"},Et={class:"jg-log-lf-item"},Tt={class:"jg-log-body"},Lt={class:"table jg-table"},Pt={class:"jg-td-c"},Vt={class:"jg-td-c"},Mt={class:"jg-td-c"},Nt={class:"jg-td-c"},Ut={class:"jg-td-c"},Ot={class:"jg-td-c"},Rt={class:"jg-td-c"},At={class:"jg-table-tools"},Gt={key:0,class:"jg-table-tool"},It=["href"],qt=["onClick"],Bt={class:"jg-log-footer"},Ft={class:"jg-navigation"},Ht={class:"pagination"},zt={key:0,class:"page-item"},Kt={class:"page-item"},Xt={__name:"list",setup(h){const j=F();let y=rt(),{currentRoute:{_rawValue:{params:{app_key:m}}}}=y,v={offset:1,limit:15,app_key:m,user_id:"",description:""},e=G({isShowPullDialog:!1,params:n.clone(v),list:[],range:{start:new Date(Date.now()-1*24*60*60*1e3),end:new Date(Date.now()+1*24*60*60*1e3)}});function g(i,a="yyyy-MM-dd"){return n.formatTime(new Date(i).getTime(),a)}function b(i){e.isShowPullDialog=i}function w(i){let a={...i,app_key:m};L.create(a).then(_=>{let{code:s,msg:c}=_;n.isEqual(s,U.SUCCESS)?(n.extend(e.params,n.clone(v)),b(!1),k()):j.proxy.$toast({icon:"error",text:`Error: ${s} ${c}`})})}function f(){k()}function l(){let{offset:i}=e.params;i+=1,n.extend(e.params,{offset:i}),k()}function $(){let{offset:i}=e.params;i-=1,n.extend(e.params,{offset:i}),k()}function r(i){L.download({id:i.id,app_key:m}).then(_=>{a(_,`jugglelog-${g(Date.now(),"yyyyMMddhhmmss")}.zip`)});function a(_,s){const c=document.createElement("a");c.download=s;const D=URL.createObjectURL(_);c.href=D,document.body.appendChild(c),c.click(),c.remove(),URL.revokeObjectURL(D)}}function k(){let{start:i,end:a}=e.range,_={...e.params,start:i.getTime(),end:a.getTime()};L.getList(_).then(s=>{let{code:c,data:D,msg:H=""}=s;if(n.isEqual(c,U.SUCCESS)){let{items:C}=D;C=n.map(C,E=>{let{created_time:z,start:K,end:W,state:J,platform:Q}=E,X=n.find(O,ot=>ot.value==Q),Y=(O[X]||{name:""}).name,Z=R[J],tt=g(K,"yyyy-MM-dd hh:mm:ss"),et=g(W,"yyyy-MM-dd hh:mm:ss"),st=g(z,"yyyy-MM-dd hh:mm:ss");return n.extend(E,{statusName:Z,startName:tt,endName:et,createName:st,platformName:Y}),E}),e.list=C}else j.proxy.$toast({icon:"error",text:`Error: ${c} ${H}`})})}return k(),(i,a)=>{const _=I("VDatePicker");return u(),p("div",bt,[t("div",kt,[t("ul",wt,[t("li",$t,[V(_,{modelValue:o(e).range,"onUpdate:modelValue":a[0]||(a[0]=s=>o(e).range=s),modelModifiers:{range:!0}},{default:P(({togglePopover:s})=>[t("div",{class:"form-control jg-as-date-content",onClick:s},d(g(o(e).range.start))+" 至 "+d(g(o(e).range.end)),9,xt)]),_:1},8,["modelValue"])]),t("li",Dt,[x(t("input",{class:"form-control",type:"text","onUpdate:modelValue":a[1]||(a[1]=s=>o(e).params.user_id=s),placeholder:"用户 ID",autocomplete:"off",onKeydown:N(f,["enter"])},null,544),[[S,o(e).params.user_id]])]),t("li",St,[x(t("input",{class:"form-control",type:"text","onUpdate:modelValue":a[2]||(a[2]=s=>o(e).params.description=s),placeholder:"备注信息",autocomplete:"off",onKeydown:N(f,["enter"])},null,544),[[S,o(e).params.description]])]),t("li",{class:"jg-log-lf-item"},[t("div",{class:"jg-button jg-button-bg",onClick:f},"查询")])]),t("ul",Ct,[t("li",Et,[t("div",{class:"jg-button jg-button-bg jg-button-green",onClick:a[3]||(a[3]=s=>b(!0))},"拉取日志")])])]),t("div",Tt,[t("table",Lt,[a[5]||(a[5]=t("thead",null,[t("tr",null,[t("th",{class:"jg-td-c"},"用户 ID"),t("th",{class:"jg-td-c"},"平台"),t("th",{class:"jg-td-c"},"收集时间"),t("th",{class:"jg-td-c"},"拉取时间"),t("th",{class:"jg-td-c"},"日志状态"),t("th",{class:"jg-td-c"},"日志备注"),t("th",{class:"jg-td-c"},"操作")])],-1)),t("tbody",null,[(u(!0),p(B,null,q(o(e).list,s=>(u(),p("tr",null,[t("td",Pt,d(s.user_id),1),t("td",Vt,d(s.platformName),1),t("td",Mt,d(s.startName)+" 至 "+d(s.endName),1),t("td",Nt,d(s.createName),1),t("td",Ut,[t("span",{class:it(["jgicon jg-log-status",["jgicon-status-"+s.state]])},d(s.statusName),3)]),t("td",Ot,d(s.description),1),t("td",Rt,[t("ul",At,[o(n).isEqual(s.state,o(R).COMPLETE)?(u(),p("li",Gt,[s.log_url?(u(),p("a",{key:0,class:"btn-link",href:s.log_url},"下载",8,It)):(u(),p("a",{key:1,class:"btn-link",href:"#",onClick:c=>r(s)},"下载",8,qt))])):T("",!0)])])]))),256))])])]),t("div",Bt,[t("nav",Ft,[t("ul",Ht,[o(e).params.offset>1?(u(),p("li",zt,[t("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:$},a[6]||(a[6]=[t("span",{"aria-hidden":"true"},"上一页",-1)]))])):T("",!0),t("li",Kt,[o(e).list.length>=o(e).params.limit?(u(),p("a",{key:0,class:"page-link",href:"#","aria-label":"Next",onClick:l},a[7]||(a[7]=[t("span",{"aria-hidden":"true"},"下一页",-1)]))):T("",!0)])])])]),V(vt,{show:o(e).isShowPullDialog,title:"拉取日志",text:"确定",type:o(e).dialogType,onHide:a[4]||(a[4]=s=>b(!1)),onSave:w},null,8,["show","type"])])}}};export{Xt as default};
