import{r as $,a8 as l,d as a,c as u,a as e,F as B,b as C,u as r,h as A,w as I,E as g,o as c,t as i,p as L,j as S,v as y,k,g as U}from"./index-fb0c9453.js";import{_ as P}from"./dialog-61be0fc3.js";import{U as f}from"./user-90d42ed6.js";const h={class:"mb-4"},D={class:"header jg-header"},N={class:"table jg-table"},T={class:"jg-td-c jg-td-operate"},q=["onClick"],V=["onClick"],R={class:"row g-2 jg-row"},F={class:"form-floating"},X=["disabled"],z={key:0,class:"invalid-feedback feedback"},H={class:"form-floating"},O={key:0,class:"invalid-feedback feedback"},G={class:"form-floating"},J={key:0,class:"invalid-feedback feedback"},Z={__name:"manager",setup(K){let p=U(),x={account:"",password:"",confirmPasswrod:"",state:l.ENABLE},o=$({users:[],radios:[{name:"type",value:l.ENABLE,label:"启用"},{name:"type",value:l.DISABLE,label:"禁用"}],isShowEdit:!1,user:a.clone(x),accountErrorMsg:"",pwdErrorMsg:"",conPwdErrorMsg:""});f.getUsers().then(({data:n})=>{let{items:t}=n;o.users=t.map(s=>(s.time=a.formatTime(s.created_time),s))});function w(n,t){o.isShowEdit=n,t&&(o.user=t),n||(o.user=a.clone(x))}function j(n){let t;a.isEqual(n.state,l.ENABLE)&&(t=l.DISABLE),a.isEqual(n.state,l.DISABLE)&&(t=l.ENABLE),f.disable({accounts:[n.account],is_disable:t}).then(()=>{o.users.map(s=>(a.isEqual(n.account,s.account)&&a.extend(s,{state:t}),s)),p.proxy.$toast({icon:"success",text:"操作成功",duration:4e3})})}function M(n){let t=o.users[n];f.remove({accounts:[t.account]}).then(()=>{o.users.splice(n,1),p.proxy.$toast({icon:"success",text:"删除成功",duration:4e3})})}function _(){let{user:n}=o,{account:t,password:s,confirmPasswrod:m}=n;if(a.isEmpty(t))return o.accountErrorMsg="账户名称不能为空";if(a.isEmpty(s))return o.pwdErrorMsg="密码不能为空";if(!a.isEqual(m,s))return o.conPwdErrorMsg="两次密码输入不一致";if(n.created_time)return f.updatePwd({account:t,password:s,new_password:m}).then(({code:d,msg:E})=>{a.isEqual(d,g.SUCCESS_0.code)?p.proxy.$toast({icon:"success",text:"修改密码成功",duration:3e3}):p.proxy.$toast({icon:"error",text:`${d}:${E}`,duration:3e3})});f.add({account:t,password:s,state:n.state}).then(({code:d})=>{let E="success",b="保存成功";a.isEqual(d,g.SUCCESS_0.code)?(n.time=a.formatTime(Date.now()),o.users.push(n),w(!1)):a.isEqual(d,g.USER_EXISTS.code)?(E="error",b=g.USER_EXISTS.msg):(E="error",b="保存失败，请重试"),p.proxy.$toast({icon:E,text:b,duration:4e3})})}function v(n){({account:()=>{o.accountErrorMsg=""},pwd:()=>{o.pwdErrorMsg=""},confirm:()=>{o.conPwdErrorMsg=""}})[n]()}return(n,t)=>(c(),u("div",h,[e("div",D,[t[9]||(t[9]=e("div",{class:"jg-title"},"用户管理",-1)),e("div",{class:"jgicon jgicon-add jg-button jg-button-bg",onClick:t[0]||(t[0]=s=>w(!0))},"添加用户")]),e("table",N,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",null,"用户名称"),e("th",null,"用户账号"),e("th",null,"用户密码"),e("th",null,"是否启用"),e("th",null,"创建时间"),e("th",{class:"jg-td-c"},"操作")])],-1)),e("tbody",null,[(c(!0),u(B,null,C(r(o).users,(s,m)=>(c(),u("tr",null,[e("td",null,i(s.account),1),e("td",null,i(s.account),1),t[10]||(t[10]=e("td",null,"**** ****",-1)),e("td",{class:L(["jgicon",{"jgicon-success":s.state==r(l).ENABLE,"jgicon-error":s.state==r(l).DISABLE}])},i(s.state==r(l).ENABLE?"已启用":"已禁用"),3),e("td",null,i(s.time),1),e("td",T,[e("a",{class:"btn-link jg-btn-link",type:"button",onClick:d=>j(s)},i(s.state==r(l).DISABLE?"启用":"禁用"),9,q),e("a",{class:"btn-link jg-btn-link",type:"button",onClick:d=>M(m)},"删除",8,V)])]))),256))])]),A(P,{show:r(o).isShowEdit,title:"用户变更",onHide:t[7]||(t[7]=s=>w(!1)),onSave:t[8]||(t[8]=s=>_())},{default:I(()=>[e("div",R,[e("div",F,[S(e("input",{class:"form-control",disabled:r(o).user.created_time,"onUpdate:modelValue":t[1]||(t[1]=s=>r(o).user.account=s),type:"text",placeholder:"用户名称",autocomplete:"off",onInput:t[2]||(t[2]=s=>v("account"))},null,40,X),[[y,r(o).user.account]]),t[12]||(t[12]=e("label",null,"用户名称",-1)),r(o).accountErrorMsg?(c(),u("div",z,i(r(o).accountErrorMsg),1)):k("",!0)]),e("div",H,[S(e("input",{class:"form-control","onUpdate:modelValue":t[3]||(t[3]=s=>r(o).user.password=s),type:"text",placeholder:"用户密码",onInput:t[4]||(t[4]=s=>v("pwd"))},null,544),[[y,r(o).user.password]]),t[13]||(t[13]=e("label",null,"用户密码",-1)),r(o).pwdErrorMsg?(c(),u("div",O,i(r(o).pwdErrorMsg),1)):k("",!0)]),e("div",G,[S(e("input",{class:"form-control","onUpdate:modelValue":t[5]||(t[5]=s=>r(o).user.confirmPasswrod=s),type:"text",placeholder:"确认密码",onInput:t[6]||(t[6]=s=>v("confirm"))},null,544),[[y,r(o).user.confirmPasswrod]]),t[14]||(t[14]=e("label",null,"确认密码",-1)),r(o).conPwdErrorMsg?(c(),u("div",J,i(r(o).conPwdErrorMsg),1)):k("",!0)]),t[15]||(t[15]=e("input",{type:"password",autocomplete:"new-password",style:{display:"none"}},null,-1))])]),_:1},8,["show"])]))}};export{Z as default};
