import{_ as b}from"./form-53ecf278.js";import{B as s,c as o,a as d,F as h,b as v,u as f,i as w,A as l,d as r,R as C,o as i,p as g,t as S,h as A,g as E}from"./index-a6509667.js";const P={class:"md-4"},I={class:"nav nav-underline-border",role:"tablist"},$=["onClick"],O={class:"tab-content rounded-bottom"},B={class:"row jg-sw-row"},j={__name:"push",setup(F){let m=w(),{currentRoute:{_rawValue:{params:{app_key:c}}}}=m;const u=E();let n=[{type:"Huawei",name:"华为",state:s({package:"",app_id:"",app_secret:""}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"app_id",label:"App Id",type:"input_text"},{name:"app_secret",label:"App Secret",type:"input_text"}]},{type:"Xiaomi",name:"小米",state:s({package:"",app_secret:""}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"app_secret",label:"App Secret",type:"input_text"}]},{type:"Oppo",name:"OPPO",state:s({package:"",app_key:"",master_secret:""}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"app_key",label:"App Key",type:"input_text"},{name:"master_secret",label:"Master Secret",type:"input_text"}]},{type:"Vivo",name:"vivo",state:s({package:"",app_id:"",app_key:"",app_secret:""}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"app_id",label:"App Id",type:"input_text"},{name:"app_key",label:"App Key",type:"input_text"},{name:"app_secret",label:"App Secret",type:"input_text"}]},{type:"ios",name:"iOS",state:s({package:"",cert_path:"",cert_pwd:"",is_product:0}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"cert_path",label:"证书文件",type:"file"},{name:"cert_pwd",label:"证书密码",type:"input_text"},{name:"is_product",label:"证书环境",type:"radios",radios:[{name:"type",value:0,label:"开发环境"},{name:"type",value:1,label:"生产环境"}]}]},{type:"fcm",name:"FCM",state:s({package:"",conf_path:"",app_key:"",fcm_conf:""}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"fcm_conf",label:"证书文件",type:"file"}]}];const p=s(n[0].type);function k(e){p.value=e.type,y()}function x(e){if(p.value.startsWith("ios")){let{file:t}=e;if(!t.name)return l.setIosPushConfig({app_key:c,package:e.package,cert_pwd:e.cert_pwd,is_product:e.is_product}).then(()=>{u.proxy.$toast({icon:"success",text:"保存成功"})});l.uploadIosPushConfig({app_key:c,package:e.package,cert_pwd:e.cert_pwd,file:e.file,is_product:e.is_product}).then(()=>{u.proxy.$toast({icon:"success",text:"保存成功"})})}else l.setAndroidPushConfig({app_key:c,push_channel:p.value,package:e.package,extra:e}).then(()=>{u.proxy.$toast({icon:"success",text:"保存成功"})})}async function y(){if(p.value.startsWith("ios")){const e=await l.getIosPushConfig({app_key:c,push_channel:p.value});let{data:t}=e;t||(t={is_product:0}),r.forEach(n,a=>{a.type===p.value&&(a.state.value={...a.state.value,package:t.package,cert_path:t.cert_path,cert_pwd:t.cert_pwd,is_product:t.is_product})})}else if(p.value.startsWith("fcm")){const e=await l.getFcmPushConfig({app_key:c,push_channel:p.value});let{data:t}=e;t||(t={is_product:0}),r.forEach(n,a=>{a.type===p.value&&(a.state.value={...a.state.value,package:t.package,fcm_conf:t.conf_path})})}else{const e=await l.getAndroidPushConfig({app_key:c,push_channel:p.value});let{code:t,data:a={}}=e;if(!r.isEqual(t,C.SUCCESS))return u.proxy.$toast({icon:"error",text:"查询异常，请刷新重试"});r.forEach(n,_=>{_.type===p.value&&(_.state.value={..._.state.value,package:a.package,...a.extra})})}}return y(),(e,t)=>(i(),o("div",P,[d("ul",I,[(i(!0),o(h,null,v(f(n),a=>(i(),o("li",{class:"nav-item sw-nav-item",onClick:_=>k(a)},[d("a",{class:g(["nav-link jgicon jgicon-free",{active:f(r).isEqual(p.value,a.type)}])},S(a.name),3)],8,$))),256))]),d("div",O,[(i(!0),o(h,null,v(f(n),a=>(i(),o("div",{class:g(["tab-pane p-3",{active:f(r).isEqual(p.value,a.type)}])},[d("div",B,[A(b,{fields:a.fields,state:a.state.value,onSave:x},null,8,["fields","state"])])],2))),256))])]))}};export{j as default};
