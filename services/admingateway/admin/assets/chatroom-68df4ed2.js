import{r as V,ac as E,n as R,z as F,c as f,b as l,k as u,u as m,F as N,d as S,w as O,l as P,e as i,H as U,o as w,x as W,t as v,ad as B,h as $}from"./index-668b837b.js";import{c as d,A as z}from"./common-15833b08.js";import{_ as b}from"./analysis-day-e3c332de.js";const G={class:"mb-4 cim-as-box"},H={class:"row cim-cb-row cim-as-header"},I={class:"cim-bk-form"},Y={class:"row cim-asr-row"},q={class:"cim-as-tools"},L={class:"cim-as-tool"},j=["onClick"],J={class:"cim-as-date cicon cicon-date"},K=["onClick"],Q={class:"row cim-as-body"},X={class:"cim-bk-form",ref:"asuserchat"},st={__name:"chatroom",setup(Z){const C=$();let M=P(),{currentRoute:{_rawValue:{params:{app_key:p}}}}=M,s=V({buttons:E,range:{start:new Date(Date.now()-8*24*60*60*1e3),end:new Date(Date.now()-1*24*60*60*1e3)},yestday:{upMsg:{percent:0,isUp:!0,count:0},downMsg:{percent:0,isUp:!0,count:0},disMsg:{percent:0,isUp:!0,count:0},online:{percent:0,isUp:!0,count:0}}}),_=null;function g(e){if(!_){let{asuserchat:n}=C.refs;_=C.proxy.$echat.init(n)}let{upMsgs:a,downMsgs:r,disMsgs:t,dates:c}=d.formatChatData(e);const o=["#5470C6","#008000","#EE6666"];let h={legend:{data:["聊天室上行消息量","聊天室下行消息量","聊天室分发消息量"]},tooltip:{trigger:"none",axisPointer:{type:"cross"}},xAxis:{type:"category",boundaryGap:!1,data:c},yAxis:{type:"value",axisPointer:{label:{formatter:function(n){return i.numberWithCommas(n.value.toFixed(0))}}}},series:[{name:"聊天室上行消息量",type:"line",smooth:!0,data:a,lineStyle:{color:o[0]},label:{show:!0,position:"top",formatter:function(n){return i.numberWithCommas(n.value.toFixed(0))}}},{name:"聊天室下行消息量",type:"line",smooth:!0,lineStyle:{color:o[1]},data:r,label:{show:!0,position:"top",formatter:function(n){return i.numberWithCommas(n.value.toFixed(0))}}},{name:"聊天室分发消息量",type:"line",smooth:!0,lineStyle:{color:o[2]},data:t,label:{show:!0,position:"top",formatter:function(n){return i.numberWithCommas(n.value.toFixed(0))}}}]};_.setOption(h)}async function y(e){let{data:a}=await z.getMessageChat({...e,channel_type:B.CHATROOM}),{msg_dispatch:r={items:[]},msg_down:t={items:[]},msg_up:c={items:[]}}=a,o=(A,T)=>A.time_mark>T.time_mark,h=i.sort(r.items,o),n=i.sort(t.items,o),D=i.sort(c.items,o);return{disMsgs:h,downMsgs:n,upMsgs:D}}function x(e){return i.formatTime(new Date(e).getTime(),"yyyy-MM-dd")}async function k(e){i.map(s.buttons,o=>(o.isActive=i.isEqual(o.name,e.name),o));let{start:a,end:r}=d.getRangeDate(e.name),c=await y({app_key:p,start:a,end:r});g(c)}return R(()=>{let{start:e,end:a}=d.getRangeDate(8);y({app_key:p,start:e,end:a}).then(t=>{let c=d.calcYesterday(t);i.extend(s.yestday,c),g(t)})}),F(()=>s.range,async()=>{let{start:e,end:a}=s.range;e=new Date(e).getTime(),a=new Date(a).getTime();let t=await y({app_key:p,start:e,end:a});g(t)}),(e,a)=>{const r=U("VDatePicker");return w(),f("div",G,[l("div",H,[l("div",I,[l("div",Y,[u(b,{title:"昨日聊天室上行消息量（条）",item:m(s).yestday.upMsg},null,8,["item"]),u(b,{title:"昨日聊天室下行消息量（条）",item:m(s).yestday.downMsg},null,8,["item"]),u(b,{title:"昨日聊天室分发消息量（条）",item:m(s).yestday.disMsg},null,8,["item"])])])]),l("div",q,[l("div",L,[(w(!0),f(N,null,S(m(s).buttons,t=>(w(),f("div",{class:W(["cim-as-button",{"cim-as-button-active":t.isActive}]),onClick:c=>k(t)},v(t.title),11,j))),256)),l("div",J,[u(r,{modelValue:m(s).range,"onUpdate:modelValue":a[0]||(a[0]=t=>m(s).range=t),modelModifiers:{range:!0},class:"cim-as-date-picker"},{default:O(({togglePopover:t})=>[l("div",{class:"cim-as-date-content",onClick:t},v(x(m(s).range.start))+" 至 "+v(x(m(s).range.end)),9,K)]),_:1},8,["modelValue"])])])]),l("div",Q,[l("div",X,null,512)])])}}};export{st as default};
