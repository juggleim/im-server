import{_ as q}from"./form-51469c71.js";import{B as p,r as R,z as $,w as T,i as z,A as h,d as _,R as D,C as F,o,a as t,t as v,u as l,c as i,b as k,F as g,k as S,p as j,h as M,g as W}from"./index-0818f5f9.js";const I={class:"mb-4 app-base jg-cb-box"},L={class:"row jg-cb-row jg-cb-header"},O={class:"jg-cb-form jg-file-form"},P={class:"jg-cb-form-item"},U=t("label",{class:"col-sm-1 col-form-label jg-form-item-label"}," 正在使用存储 ",-1),G={class:"col-sm-7"},H={class:"warn"},J={class:"jg-cb-form-item"},Q=t("label",{class:"col-sm-1 col-form-label"}," 设置存储类型 ",-1),X={class:"col-sm-4 store-form"},Y={class:"form-check-inline store_inline"},Z=["value","checked"],ee={class:"form-check-label"},te={key:0,class:"form-check-inline store_inline"},ne=t("span",{class:"warn fs-12"},"请优先添加文件存储配置",-1),ae=[ne],se={class:"col-sm-3 jg-cb-btns"},le={class:"md-6"},ce={class:"nav nav-underline-border",role:"tablist"},oe=["onClick"],ie={class:"tab-content rounded-bottom"},de={__name:"storage",setup(re){let w=z(),b=W(),{currentRoute:{_rawValue:{params:{app_key:d}}}}=w,m=[{type:"aws",name:"AWS",state:p({access_key:"",secret_key:"",endpoint:"",region:"",bucket:""}),fields:[{name:"access_key",label:"Access Key",type:"input_text"},{name:"secret_key",label:"Secret Key",type:"input_text"},{name:"endpoint",label:"Endpoint",type:"input_text"},{name:"region",label:"Region",type:"input_text"},{name:"bucket",label:"Buket Name",type:"input_text"}]},{type:"qiniu",name:"七牛云",state:p({access_key:"",secret_key:"",bucket:""}),fields:[{name:"access_key",label:"Access Key",type:"input_text"},{name:"secret_key",label:"Secret Key",type:"input_text"},{name:"domain",label:"Domain Name",type:"input_text"},{name:"bucket",label:"Bucket Name",type:"input_text"}]},{type:"oss",name:"阿里云",state:p({access_key:"",secret_key:"",endpoint:"",bucket:""}),fields:[{name:"access_key",label:"Access Key",type:"input_text"},{name:"secret_key",label:"Secret Key",type:"input_text"},{name:"endpoint",label:"Endpoint",type:"input_text"},{name:"bucket",label:"Bucket name",type:"input_text"}]}],e=R({checkedValue:{},current:"",channels:{oss:{name:"阿里云"},aws:{name:"AWS"},qiniu:{name:"七牛云"}},fileConfs:[],formTitle:"添加配置"});const c=p(m[0].type);function E(n){c.value=n.type,x()}function C(){return e.fileConfs.find(s=>s.channel==c.value)}function B(n){let s=C();h.setStorageConfig({app_key:d,channel:c.value,conf:n}).then(()=>{let r=c.value,a=0,u=e.channels[r].name,y={channel:c,enable:a,name:u};if(!s)return e.fileConfs.push(y),b.proxy.$toast({icon:"success",text:"添加成功，请选择存储类型后，保存设置"});b.proxy.$toast({icon:"success",text:"修改成功，请选择存储类型后，保存设置"})})}async function x(){const n=await h.getStorageConfig({app_key:d,channel:c.value});_.forEach(m,s=>{s.type===c.value&&n.data&&n.data.conf&&(s.state.value={...s.state.value,...n.data.conf})}),e.formTitle=C()?"修改配置":"添加配置"}x();function A(n){let s=n.target.value;e.checkedValue.value=s}function N(){h.getEnableStorage({app_key:d}).then(n=>{let{code:s,data:r={}}=n;if(_.isEqual(s,D.SUCCESS)){let{file_confs:a}=r,u={channel:""},y=_.map(a,f=>{let K=e.channels[f.channel]||{name:""};return f.enable&&(u=f),{...f,name:K.name}});e.current=u.channel,e.fileConfs=y}})}function V(){let n=e.checkedValue.value;h.setEnableStorage({app_key:d,channel:n}).then(()=>{e.current=n,b.proxy.$toast({icon:"success",text:"保存成功"})})}return N(),(n,s)=>{const r=F("n-flex");return o(),$(r,{vertical:""},{default:T(()=>[t("div",I,[t("div",L,[t("div",O,[t("div",P,[U,t("div",G,[t("span",H,v(l(e).channels[l(e).current]&&l(e).channels[l(e).current].name||"未设置"),1)])]),t("div",J,[Q,t("div",X,[(o(!0),i(g,null,k(l(e).fileConfs,a=>(o(),i("div",Y,[t("input",{class:"form-check-input",type:"radio",name:"setting.name",value:a.channel,checked:a.enable,onChange:A},null,40,Z),t("label",ee,v(a.name),1)]))),256)),l(e).fileConfs.length==0?(o(),i("div",te,ae)):S("",!0)]),t("div",se,[l(e).fileConfs.length>0?(o(),i("div",{key:0,class:"jg-button jg-button-bg warn-bg",onClick:V},"保存设置")):S("",!0)])])])])]),t("div",le,[t("ul",ce,[(o(!0),i(g,null,k(l(m),a=>(o(),i("li",{class:"nav-item sw-nav-item",onClick:u=>E(a)},[t("a",{class:j(["nav-link jgicon jgicon-free",{active:l(_).isEqual(c.value,a.type)}])}," 添加 "+v(a.name)+" 配置",3)],8,oe))),256))]),t("div",ie,[(o(!0),i(g,null,k(l(m),a=>(o(),i("div",{class:j(["tab-pane p-3",{active:l(_).isEqual(c.value,a.type)}])},[M(q,{fields:a.fields,state:a.state.value,"btn-type":1,title:l(e).formTitle,onSave:B},null,8,["fields","state","title"])],2))),256))])])]),_:1})}}};export{de as default};
