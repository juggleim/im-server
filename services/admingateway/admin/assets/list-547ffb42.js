import{P as M,O as R,a3 as Z,d as i,r as I,C as G,o as f,z as tt,w as P,a as t,j as x,x as et,u as o,c as y,b as q,t as d,F as A,h as V,v as C,g as B,$ as U,k as T,i as st,R as N,p as ot,a4 as O}from"./index-fb0c9453.js";import{_ as at}from"./dialog-61be0fc3.js";function lt(_){let{limit:h=15,offset:j=1,app_key:u,user_id:v,start:e,end:m,description:b}=_,$=`${M.LOG_GET_LIST}?app_key=${u}&user_id=${v}&limit=${h}&offset=${j}&start=${e}&end=${m}&description=${b}`;return R($,{method:"GET"})}function nt(_){let{app_key:h,id:j}=_,u=`${M.LOG_DOWNLOAD}?app_key=${h}&id=${j}`;return Z(u,{method:"GET"})}function rt(_){return R(M.LOG_CREATE_PULL,{method:"POST",body:i.toJSON(_)})}const L={getList:lt,create:rt,download:nt},it={class:"row g-2 jg-row jg-dialog-pull-row"},dt={class:"form-floating"},ct=["value"],ut={class:"form-floating jg-dialog-pull-datetime"},mt=["onClick"],gt={class:"form-floating jg-from-must jgicon jgicon-must"},pt={class:"form-floating jg-from-must jgicon jgicon-must"},ft={__name:"dialog-pull-log",props:["title","text"],emits:["save","hide"],setup(_,{emit:h}){const j=B(),u=_,v=h;let e=I({params:{user_id:"",description:"",platfrom:"android"},range:{start:new Date(Date.now()-1*24*60*60*1e3),end:new Date},times:[{value:"1"}],categories:[{name:"业务日志",value:1}],platfroms:[{name:"Android",value:"android"},{name:"iOS",value:"ios"},{name:"Web",value:"web"},{name:"PC",value:"pc"}]});function m(){let{user_id:g,description:l}=e.params;if(i.isEqual(g.length,0))return j.proxy.$toast({icon:"error",text:"用户 ID 不可为空"});if(i.isEqual(l.length,0))return j.proxy.$toast({icon:"error",text:"备注 不可为空"});let k=i.clone(e.params),{start:n,end:w}=e.range;v("save",{...k,start:n.getTime(),end:w.getTime()})}function b(g){v("hide",{})}function $(g){return i.formatTime(new Date(g).getTime(),"yyyy-MM-dd hh:mm")}return(g,l)=>{const k=G("VDatePicker");return f(),tt(at,{title:u.title,"btn-title":u.text,cls:"jg-pull-dialog",onHide:b,onSave:m},{default:P(()=>[t("div",it,[t("div",dt,[x(t("select",{class:"form-select","onUpdate:modelValue":l[0]||(l[0]=n=>o(e).params.platfrom=n)},[(f(!0),y(A,null,q(o(e).platfroms,n=>(f(),y("option",{value:n.value},d(n.name),9,ct))),256))],512),[[et,o(e).params.platfrom]]),l[4]||(l[4]=t("label",null,"平台",-1))]),t("div",ut,[V(k,{modelValue:o(e).range,"onUpdate:modelValue":l[1]||(l[1]=n=>o(e).range=n),modelModifiers:{range:!0},mode:"dateTime",is24hr:""},{default:P(({togglePopover:n})=>[t("div",{class:"form-control jg-as-date-content",onClick:n},d($(o(e).range.start))+" 至 "+d($(o(e).range.end)),9,mt)]),_:1},8,["modelValue"]),l[5]||(l[5]=t("label",null,"时间范围",-1))]),t("div",gt,[x(t("input",{class:"form-control",placeholder:"用户 ID","onUpdate:modelValue":l[2]||(l[2]=n=>o(e).params.user_id=n)},null,512),[[C,o(e).params.user_id]]),l[6]||(l[6]=t("label",null,"用户 ID ",-1))]),t("div",pt,[x(t("input",{class:"form-control",placeholder:"备注说明","onUpdate:modelValue":l[3]||(l[3]=n=>o(e).params.description=n)},null,512),[[C,o(e).params.description]]),l[7]||(l[7]=t("label",null,"备注说明",-1))])])]),_:1},8,["title","btn-title"])}}},_t={class:"mb-4 jg-log-contanier"},ht={class:"jg-log-header"},jt={class:"jg-log-header-lf-box"},yt={class:"jg-log-lf-item"},vt=["onClick"],bt={class:"jg-log-lf-item"},wt={class:"jg-log-lf-item"},$t={class:"jg-log-header-rg-box"},kt={class:"jg-log-lf-item"},xt={class:"jg-log-body"},Dt={class:"table jg-table"},Ct={class:"jg-td-c"},St={class:"jg-td-c"},Et={class:"jg-td-c"},Tt={class:"jg-td-c"},Lt={class:"jg-td-c"},Pt={class:"jg-td-c"},Vt={class:"jg-td-c"},Mt={class:"jg-td-c"},Ut={class:"jg-td-c"},Nt={class:"jg-table-tools"},Ot={class:"jg-table-tool"},Rt=["onClick"],It={class:"jg-log-footer"},Gt={class:"jg-navigation"},qt={class:"pagination"},At={key:0,class:"page-item"},Bt={class:"page-item"},Ft={__name:"list",setup(_){const h=B();let j=st(),{currentRoute:{_rawValue:{params:{app_key:u}}}}=j,v={offset:1,limit:15,app_key:u,user_id:"",description:""},e=I({isShowPullDialog:!1,params:i.clone(v),list:[],range:{start:new Date(Date.now()-1*24*60*60*1e3),end:new Date(Date.now()+1*24*60*60*1e3)}});function m(r,a="yyyy-MM-dd"){return i.formatTime(new Date(r).getTime(),a)}function b(r){e.isShowPullDialog=r}function $(r){let a={...r,app_key:u};L.create(a).then(p=>{let{code:s,msg:c}=p;i.isEqual(s,N.SUCCESS)?(i.extend(e.params,i.clone(v)),b(!1),w()):h.proxy.$toast({icon:"error",text:`Error: ${s} ${c}`})})}function g(){w()}function l(){let{offset:r}=e.params;r+=1,i.extend(e.params,{offset:r}),w()}function k(){let{offset:r}=e.params;r-=1,i.extend(e.params,{offset:r}),w()}function n(r){L.download({id:r.id,app_key:u}).then(p=>{a(p,`jugglelog-${m(Date.now(),"yyyyMMddhhmmss")}.zip`)});function a(p,s){const c=document.createElement("a");c.download=s;const D=URL.createObjectURL(p);c.href=D,document.body.appendChild(c),c.click(),c.remove(),URL.revokeObjectURL(D)}}function w(){let{start:r,end:a}=e.range,p={...e.params,start:r.getTime(),end:a.getTime()};L.getList(p).then(s=>{let{code:c,data:D,msg:H=""}=s;if(i.isEqual(c,N.SUCCESS)){let{items:S}=D;S=i.map(S,E=>{let{created_time:z,start:F,end:K,state:W}=E,J=O[W],Q=m(F,"yyyy-MM-dd hh:mm:ss"),X=m(K,"yyyy-MM-dd hh:mm:ss"),Y=m(z,"yyyy-MM-dd hh:mm:ss");return i.extend(E,{statusName:J,startName:Q,endName:X,createName:Y}),E}),e.list=S}else h.proxy.$toast({icon:"error",text:`Error: ${c} ${H}`})})}return w(),(r,a)=>{const p=G("VDatePicker");return f(),y("div",_t,[t("div",ht,[t("ul",jt,[t("li",yt,[V(p,{modelValue:o(e).range,"onUpdate:modelValue":a[0]||(a[0]=s=>o(e).range=s),modelModifiers:{range:!0}},{default:P(({togglePopover:s})=>[t("div",{class:"form-control jg-as-date-content",onClick:s},d(m(o(e).range.start))+" 至 "+d(m(o(e).range.end)),9,vt)]),_:1},8,["modelValue"])]),t("li",bt,[x(t("input",{class:"form-control",type:"text","onUpdate:modelValue":a[1]||(a[1]=s=>o(e).params.user_id=s),placeholder:"用户 ID",autocomplete:"off",onKeydown:U(g,["enter"])},null,544),[[C,o(e).params.user_id]])]),t("li",wt,[x(t("input",{class:"form-control",type:"text","onUpdate:modelValue":a[2]||(a[2]=s=>o(e).params.description=s),placeholder:"备注信息",autocomplete:"off",onKeydown:U(g,["enter"])},null,544),[[C,o(e).params.description]])]),t("li",{class:"jg-log-lf-item"},[t("div",{class:"jg-button jg-button-bg",onClick:g},"查询")])]),t("ul",$t,[t("li",kt,[t("div",{class:"jg-button jg-button-bg jg-button-green",onClick:a[3]||(a[3]=s=>b(!0))},"拉取日志")])])]),t("div",xt,[t("table",Dt,[a[5]||(a[5]=t("thead",null,[t("tr",null,[t("th",{class:"jg-td-c"},"用户 ID"),t("th",{class:"jg-td-c"},"指令 ID"),t("th",{class:"jg-td-c"},"平台"),t("th",{class:"jg-td-c"},"收集时间"),t("th",{class:"jg-td-c"},"拉取时间"),t("th",{class:"jg-td-c"},"日志状态"),t("th",{class:"jg-td-c"},"日志备注"),t("th",{class:"jg-td-c"},"异常信息"),t("th",{class:"jg-td-c"},"操作")])],-1)),t("tbody",null,[(f(!0),y(A,null,q(o(e).list,s=>(f(),y("tr",null,[t("td",Ct,d(s.user_id),1),t("td",St,d(s.msg_id),1),t("td",Et,d(s.platform),1),t("td",Tt,d(s.startName)+" 至 "+d(s.endName),1),t("td",Lt,d(s.createName),1),t("td",Pt,[t("span",{class:ot(["jgicon jg-log-status",["jgicon-status-"+s.state]])},d(s.statusName),3)]),t("td",Vt,d(s.description),1),t("td",Mt,d(s.fail_reason),1),t("td",Ut,[t("ul",Nt,[t("li",Ot,[o(i).isEqual(s.state,o(O).COMPLETE)?(f(),y("a",{key:0,class:"btn-link",href:"#",onClick:c=>n(s)},"下载",8,Rt)):T("",!0)])])])]))),256))])])]),t("div",It,[t("nav",Gt,[t("ul",qt,[o(e).params.offset>1?(f(),y("li",At,[t("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:k},a[6]||(a[6]=[t("span",{"aria-hidden":"true"},"上一页",-1)]))])):T("",!0),t("li",Bt,[o(e).list.length>=o(e).params.limit?(f(),y("a",{key:0,class:"page-link",href:"#","aria-label":"Next",onClick:l},a[7]||(a[7]=[t("span",{"aria-hidden":"true"},"下一页",-1)]))):T("",!0)])])])]),V(ft,{show:o(e).isShowPullDialog,title:"拉取日志",text:"确定",type:o(e).dialogType,onHide:a[4]||(a[4]=s=>b(!1)),onSave:$},null,8,["show","type"])])}}};export{Ft as default};
