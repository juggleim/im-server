import{_ as b}from"./form-904dadb7.js";import{G as c,c as r,b as d,F as y,d as h,u as f,l as w,A as l,e as o,R as C,o as _,x as k,t as S,k as P,h as A}from"./index-668b837b.js";const E={class:"md-4"},F={class:"nav nav-underline-border",role:"tablist"},I=["onClick"],$={class:"tab-content rounded-bottom"},V={class:"row cim-sw-row"},q={__name:"push",setup(O){let m=w(),{currentRoute:{_rawValue:{params:{app_key:s}}}}=m;const i=A();let n=[{type:"Huawei",name:"华为",state:c({package:"",app_id:"",app_secret:""}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"app_id",label:"App Id",type:"input_text"},{name:"app_secret",label:"App Secret",type:"input_text"}]},{type:"Xiaomi",name:"小米",state:c({package:"",app_secret:""}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"app_secret",label:"App Secret",type:"input_text"}]},{type:"Oppo",name:"OPPO",state:c({package:"",app_key:"",master_secret:""}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"app_key",label:"App Key",type:"input_text"},{name:"master_secret",label:"Master Secret",type:"input_text"}]},{type:"Vivo",name:"vivo",state:c({package:"",app_id:"",app_key:"",app_secret:""}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"app_id",label:"App Id",type:"input_text"},{name:"app_key",label:"App Key",type:"input_text"},{name:"app_secret",label:"App Secret",type:"input_text"}]},{type:"ios",name:"iOS",state:c({package:"",cert_path:"",cert_pwd:"",voip_ioscer:"",voip_cert_path:"",voip_cert_pwd:"",is_product:0}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"cert_path",label:"证书文件",type:"file"},{name:"cert_pwd",label:"证书密码",type:"input_text"},{name:"voip_cert_pwd",label:"VoIP 证书密码",type:"input_text"},{name:"voip_cert_path",label:"VoIP 证书文件",type:"voipfile"},{name:"is_product",label:"证书环境",type:"radios",radios:[{name:"type",value:0,label:"开发环境"},{name:"type",value:1,label:"生产环境"}]}]},{type:"fcm",name:"FCM",state:c({package:"",conf_path:"",app_key:"",fcm_conf:""}),fields:[{name:"package",label:"包名",type:"input_text"},{name:"fcm_conf",label:"证书文件",type:"file"}]}];const p=c(n[0].type);function g(e){p.value=e.type,v()}function x(e){if(p.value.startsWith("ios")){let{file:t,voipFile:a}=e;if(t.name||a.name)return l.uploadIosPushConfig({app_key:s,package:e.package,cert_pwd:e.cert_pwd,file:e.file,is_product:e.is_product,voip_cert_pwd:e.voip_cert_pwd,voipFile:e.voipFile}).then(()=>{i.proxy.$toast({icon:"success",text:"保存成功"})});l.setIosPushConfig({app_key:s,package:e.package,cert_pwd:e.cert_pwd,voip_cert_pwd:e.voip_cert_pwd,is_product:e.is_product}).then(()=>{i.proxy.$toast({icon:"success",text:"保存成功"})})}else p.value.startsWith("fcm")?l.uploadFcmPushConfig({app_key:s,package:e.package,file:e.file}).then(()=>{i.proxy.$toast({icon:"success",text:"保存成功"})}):l.setAndroidPushConfig({app_key:s,push_channel:p.value,package:e.package,extra:e}).then(()=>{i.proxy.$toast({icon:"success",text:"保存成功"})})}async function v(){if(p.value.startsWith("ios")){const e=await l.getIosPushConfig({app_key:s,push_channel:p.value});let{data:t}=e;t||(t={is_product:0}),o.forEach(n,a=>{a.type===p.value&&(a.state.value={...a.state.value,package:t.package,cert_path:t.cert_path,cert_pwd:t.cert_pwd,voip_cert_pwd:t.voip_cert_pwd,voip_cert_path:t.voip_cert_path,is_product:t.is_product})})}else if(p.value.startsWith("fcm")){const e=await l.getFcmPushConfig({app_key:s,push_channel:p.value});let{data:t}=e;t||(t={is_product:0}),o.forEach(n,a=>{a.type===p.value&&(a.state.value={...a.state.value,package:t.package,fcm_conf:t.conf_path})})}else{const e=await l.getAndroidPushConfig({app_key:s,push_channel:p.value});let{code:t,data:a={}}=e;if(!o.isEqual(t,C.SUCCESS))return i.proxy.$toast({icon:"error",text:"查询异常，请刷新重试"});o.forEach(n,u=>{u.type===p.value&&(u.state.value={...u.state.value,package:a.package,...a.extra})})}}return v(),(e,t)=>(_(),r("div",E,[d("ul",F,[(_(!0),r(y,null,h(f(n),a=>(_(),r("li",{class:"nav-item sw-nav-item",onClick:u=>g(a)},[d("a",{class:k(["nav-link cicon cicon-free",{active:f(o).isEqual(p.value,a.type)}])},S(a.name),3)],8,I))),256))]),d("div",$,[(_(!0),r(y,null,h(f(n),a=>(_(),r("div",{class:k(["tab-pane p-3",{active:f(o).isEqual(p.value,a.type)}])},[d("div",V,[P(b,{fields:a.fields,state:a.state.value,onSave:x},null,8,["fields","state"])])],2))),256))])]))}};export{q as default};
