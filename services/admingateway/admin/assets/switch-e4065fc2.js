import{r as x,z as g,e as l,o as m,c as _,b as t,t as k,p as N,v as T,u as n,B as b,w as I,x as C,_ as B,h as q,k as D,F as $,C as L,d as E,l as j,D as w,A as M,q as S}from"./index-668b837b.js";const A={class:"cim-sw-form"},H={class:"cim-form-check form-switch"},P={class:"form-check-label"},z={__name:"input",props:["item"],emits:["save"],setup(h,{emit:v}){const a=h,d=v;let s=x({value:Number(a.item.value)});function r(){let{id:o}=a.item,{value:e}=s;d("save",{id:o,value:e})}return g(()=>a.item.value,o=>{let e=Number(o);e>0&&l.extend(s,{value:e})}),(o,e)=>(m(),_("div",A,[t("div",H,[t("label",P,k(a.item.name),1),N(t("input",{class:"form-control",type:"number","onUpdate:modelValue":e[0]||(e[0]=i=>n(s).value=i)},null,512),[[T,n(s).value]]),t("div",{class:"cim-button",onClick:r},"保存")])]))}},F={class:"cim-sw-form"},O={class:"cim-form-check form-switch"},R={class:"form-check-label"},W=["checked"],J={__name:"switch",props:["item"],emits:["save"],setup(h,{emit:v}){const a=h,d=v;let s=x({value:Number(a.item.value)});function r(o){let{id:e}=a.item,i=o.target.checked,c=Number(i)+"";d("save",{id:e,value:c})}return g(()=>a.item.value,o=>{l.extend(s,{value:Number(o)})}),(o,e)=>(m(),_("div",F,[t("div",O,[t("label",R,k(a.item.name),1),t("input",{class:"form-check-input",type:"checkbox",checked:n(s).value,onChange:r},null,40,W)])]))}},Y={class:"form-floating"},G={__name:"dialog-modify-domain",props:["domains"],emits:["save","hide"],setup(h,{emit:v}){const a=q(),d=h,s=v;let r=x({domains:d.domains,text:d.domains.join(`;
`)});function o(){let{text:i}=r,c=i.split(";");c=l.filter(c,u=>!l.isEmpty(u)),c=l.map(c,u=>u.replace(`
`,""));for(let u=0;u<c.length;u++){let y=c[u];if(!l.isURL(y))return a.proxy.$toast({icon:"error",text:`${y} 格式不正确`})}s("save",{domains:c})}function e(i){s("hide",{})}return g(()=>d.domains,()=>{l.extend(r,{domains:d.domains,text:d.domains.join(`;
`)})}),(i,c)=>(m(),b(B,{title:"安全域名","btn-title":"保存",class:C(["cim-security-dialog"]),onHide:e,onSave:o},{default:I(()=>[t("div",Y,[N(t("textarea",{class:"form-control",style:{width:"36rem",height:"10rem",resize:"none"},placeholder:" ","onUpdate:modelValue":c[0]||(c[0]=u=>n(r).text=u)},null,512),[[T,n(r).text]]),c[1]||(c[1]=t("label",null,"请输入安全域名, 多个域名请用【英文分号】分割，取消设置安全域名，清空保存即可",-1))]),c[2]||(c[2]=t("div",{class:"form-example"},[t("div",{class:"title"},"域名示例："),t("ul",null,[t("li",null,"https://example.com;http://im.fake.com;http://127.0.0.1:8305"),t("li",{class:"warn"},"配置安全域名后，Web 只能在已设置的域名下连接 IM Server，生产环境请谨慎使用")])],-1))]),_:1}))}},K={class:"cim-sw-form"},Q={class:"cim-form-check form-switch"},X={class:"form-check-label"},Z={class:"cim-secrity-dm-content"},ee={key:0},te={key:1},se={__name:"input-modal",props:["item"],emits:["save"],setup(h,{emit:v}){const a=h,d=v;let s=x({isShowModal:!1,domains:[]});function r({domains:e}){let{id:i}=a.item;s.domains=e,d("save",{id:i,value:l.toJSON({domains:e})}),o(!1)}function o(e){s.isShowModal=e}return g(()=>a.item.value,e=>{e=e||'{ "domains": [] }';let i=l.parse(e);l.extend(s,{domains:i.domains})}),(e,i)=>(m(),_($,null,[t("div",K,[t("div",Q,[t("label",X,k(a.item.name),1),t("div",Z,[t("ul",null,[n(s).domains.length==0?(m(),_("li",ee,"未设置")):(m(),_("li",te,k(n(s).domains.join(";")),1))])]),t("div",{class:"cim-button",onClick:i[0]||(i[0]=c=>o(!0))},"修改")])]),D(G,{show:n(s).isShowModal,domains:n(s).domains,onHide:i[1]||(i[1]=c=>o(!1)),onSave:r},null,8,["show","domains"])],64))}},ne={class:"cim-sw-form"},ae={class:"cim-form-check form-switch"},ie={class:"form-check-label"},oe=["value"],le={__name:"select",props:["item"],emits:["save"],setup(h,{emit:v}){const a=h,d=v;let s=x({value:a.item.options[0].key});function r(){let{id:o}=a.item,{value:e}=s;d("save",{id:o,value:e})}return g(()=>a.item.value,o=>{l.extend(s,{value:o})}),(o,e)=>(m(),_("div",ne,[t("div",ae,[t("label",ie,k(a.item.name),1),N(t("select",{class:"form-select","onUpdate:modelValue":e[0]||(e[0]=i=>n(s).value=i)},[(m(!0),_($,null,E(a.item.options,i=>(m(),_("option",{value:i.key},k(i.value),9,oe))),256))],512),[[L,n(s).value]]),t("div",{class:"cim-button",onClick:r},"保存")])]))}},ce={class:"md-4"},me={class:"nav nav-underline-border",role:"tablist"},re=["onClick"],ue={class:"tab-content rounded-bottom"},de={class:"row cim-sw-row"},_e={class:"col-sm-4 cim-sw-col"},ve={__name:"switch",setup(h){let v=j(),{currentRoute:{_rawValue:{params:{app_key:a}}}}=v;const d=q();let s=[{type:"app",name:"应用相关",list:[{id:"token_effective_minute",type:"input",name:"Token 有效时长（小时）",value:0},{id:"kick_mode",type:"switch",name:"允许同设备多端登录",value:0},{id:"security_domains",type:w.INPUT_MODAL,name:"安全域名",value:'{ "domains": [] }'}]},{type:"message",name:"消息相关",list:[{id:"is_hide_msg_before_join_group",type:"switch",name:"入群后获取之前的历史消息",value:0},{id:"not_check_grp_member",type:"switch",name:"不在群组是否可以获取群消息",value:0},{id:"his_msg_save_day",type:"select",name:"历史消息存储时长 (天)",value:"7",options:[{key:"7",value:"7 天"},{key:"360",value:"1 年"}]}]},{type:"group",name:"群组相关",list:[{id:"max_grp_member_count",type:"input",name:"群人数上限",value:1e3}]},{type:"chatroom",name:"聊天室相关",list:[{id:"chrm_msg_cache_max_count",type:"input",name:"单个聊天室消息桶大小",value:50},{id:"chrm_att_max_count",type:"input",name:"单个聊天室属性数量",value:100},{id:"chrm_event_ntf",type:"switch",name:"是否开启聊天室事件通知",value:!1},{id:"chrm_event_cache_max_count",type:"input",name:"单个聊天室事件桶大小",value:50}]}],r=x({settings:s,current:s[0].type});function o(u){l.extend(r,{current:u.type})}function e(u){M.updateSetting({...u,app_key:a}).then(()=>{d.proxy.$toast({icon:"success",text:"保存成功"})})}function i(u,y){l.forEach(u,f=>{l.forEach(f.list,p=>{y(p)})})}function c(){let u=[];i(s,y=>{u.push(y.id)}),M.getSetting({app_key:a,config_keys:u}).then(({data:y})=>{let{configs:f}=y;i(r.settings,p=>{l.forEach(f,(U,V)=>{l.isEqual(p.id,V)&&(p.value=U)})})})}return c(),(u,y)=>(m(),_("div",ce,[t("ul",me,[(m(!0),_($,null,E(n(r).settings,f=>(m(),_("li",{class:"nav-item sw-nav-item",onClick:p=>o(f)},[t("a",{class:C(["nav-link cicon cicon-free",{active:n(l).isEqual(n(r).current,f.type)}])},k(f.name),3)],8,re))),256))]),t("div",ue,[(m(!0),_($,null,E(n(r).settings,f=>(m(),_("div",{class:C(["tab-pane p-3",{active:n(l).isEqual(n(r).current,f.type)}])},[t("div",de,[(m(!0),_($,null,E(f.list,p=>(m(),_("div",_e,[n(l).isEqual(p.type,n(w).INPUT)?(m(),b(z,{key:0,item:p,onSave:e},null,8,["item"])):S("",!0),n(l).isEqual(p.type,n(w).SELECT)?(m(),b(le,{key:1,item:p,onSave:e},null,8,["item"])):S("",!0),n(l).isEqual(p.type,n(w).SWITCH)?(m(),b(J,{key:2,item:p,onSave:e},null,8,["item"])):S("",!0),n(l).isEqual(p.type,n(w).INPUT_MODAL)?(m(),b(se,{key:3,item:p,onSave:e},null,8,["item"])):S("",!0)]))),256))])],2))),256))])]))}};export{ve as default};
