import{r as V,ac as E,n as R,z as F,c as f,b as l,k as d,u as m,F as N,d as P,w as S,l as U,e as i,H as W,o as w,x as B,t as v,ad as I,h as O}from"./index-668b837b.js";import{c as u,A as $}from"./common-15833b08.js";import{_ as b}from"./analysis-day-e3c332de.js";const z={class:"mb-4 cim-as-box"},G={class:"row cim-cb-row cim-as-header"},Y={class:"cim-bk-form"},q={class:"row cim-asr-row"},H={class:"cim-as-tools"},L={class:"cim-as-tool"},j=["onClick"],J={class:"cim-as-date cicon cicon-date"},K=["onClick"],Q={class:"row cim-as-body"},X={class:"cim-bk-form",ref:"asuserchat"},at={__name:"message",setup(Z){const C=O();let k=U(),{currentRoute:{_rawValue:{params:{app_key:p}}}}=k,a=V({buttons:E,range:{start:new Date(Date.now()-7*24*60*60*1e3),end:new Date(Date.now()-1*24*60*60*1e3)},yestday:{upMsg:{percent:0,isUp:!0,count:0},downMsg:{percent:0,isUp:!0,count:0},disMsg:{percent:0,isUp:!0,count:0}}}),_=null;function g(e){if(!_){let{asuserchat:n}=C.refs;_=C.proxy.$echat.init(n)}let{upMsgs:s,downMsgs:r,disMsgs:t,dates:c}=u.formatChatData(e);const o=["#5470C6","#008000","#EE6666"];let h={legend:{data:["单聊上行消息量","单聊下行消息量","单聊分发消息量"]},tooltip:{trigger:"none",axisPointer:{type:"cross"}},xAxis:{type:"category",boundaryGap:!1,data:c},yAxis:{type:"value",axisPointer:{label:{formatter:function(n){return i.numberWithCommas(n.value.toFixed(0))}}}},series:[{name:"单聊上行消息量",type:"line",smooth:!0,data:s,lineStyle:{color:o[0]},label:{show:!0,position:"top",formatter:function(n){return i.numberWithCommas(n.value.toFixed(0))}}},{name:"单聊下行消息量",type:"line",smooth:!0,lineStyle:{color:o[1]},data:r,label:{show:!0,position:"top",formatter:function(n){return i.numberWithCommas(n.value.toFixed(0))}}},{name:"单聊分发消息量",type:"line",smooth:!0,lineStyle:{color:o[2]},data:t,label:{show:!0,position:"top",formatter:function(n){return i.numberWithCommas(n.value.toFixed(0))}}}]};_.setOption(h)}async function y(e){let{data:s}=await $.getMessageChat({...e,channel_type:I.PRIVATE}),{msg_dispatch:r={items:[]},msg_down:t={items:[]},msg_up:c={items:[]}}=s,o=(A,T)=>A.time_mark>T.time_mark,h=i.sort(r.items,o),n=i.sort(t.items,o),D=i.sort(c.items,o);return{disMsgs:h,downMsgs:n,upMsgs:D}}function x(e){return i.formatTime(new Date(e).getTime(),"yyyy-MM-dd")}async function M(e){i.map(a.buttons,o=>(o.isActive=i.isEqual(o.name,e.name),o));let{start:s,end:r}=u.getRangeDate(e.name),c=await y({app_key:p,start:s,end:r});g(c)}return R(()=>{let{start:e,end:s}=u.getRangeDate(8);y({app_key:p,start:e,end:s}).then(t=>{let c=u.calcYesterday(t);i.extend(a.yestday,c),g(t)})}),F(()=>a.range,async()=>{let{start:e,end:s}=a.range;e=new Date(e).getTime(),s=new Date(s).getTime();let t=await y({app_key:p,start:e,end:s});g(t)}),(e,s)=>{const r=W("VDatePicker");return w(),f("div",z,[l("div",G,[l("div",Y,[l("div",q,[d(b,{title:"昨日单聊上行消息量（条）",item:m(a).yestday.upMsg},null,8,["item"]),d(b,{title:"昨日单聊下行消息量（条）",item:m(a).yestday.downMsg},null,8,["item"]),d(b,{title:"昨日单聊分发消息量（条）",item:m(a).yestday.disMsg},null,8,["item"])])])]),l("div",H,[l("div",L,[(w(!0),f(N,null,P(m(a).buttons,t=>(w(),f("div",{class:B(["cim-as-button",{"cim-as-button-active":t.isActive}]),onClick:c=>M(t)},v(t.title),11,j))),256)),l("div",J,[d(r,{modelValue:m(a).range,"onUpdate:modelValue":s[0]||(s[0]=t=>m(a).range=t),modelModifiers:{range:!0},class:"cim-as-date-picker"},{default:S(({togglePopover:t})=>[l("div",{class:"cim-as-date-content",onClick:t},v(x(m(a).range.start))+" 至 "+v(x(m(a).range.end)),9,K)]),_:1},8,["modelValue"])])])]),l("div",Q,[l("div",X,null,512)])])}}};export{at as default};
