import{r as M,U as l,d as a,c as d,a as s,F as $,b as B,u as r,h as C,w as U,E as _,o as u,t as i,p as A,j as b,v as h,k as S,g as I}from"./index-0818f5f9.js";import{_ as L}from"./dialog-bc66d1c4.js";import{U as f}from"./user-99a27971.js";const P={class:"mb-4"},D={class:"header jg-header"},N=s("div",{class:"jg-title"},"用户管理",-1),T={class:"table jg-table"},q=s("thead",null,[s("tr",null,[s("th",null,"用户名称"),s("th",null,"用户账号"),s("th",null,"用户密码"),s("th",null,"是否启用"),s("th",null,"创建时间"),s("th",{class:"jg-td-c"},"操作")])],-1),V=s("td",null,"**** ****",-1),R={class:"jg-td-c jg-td-operate"},F=["onClick"],X=["onClick"],z={class:"row g-2 jg-row"},H={class:"form-floating"},O=["disabled"],G=s("label",null,"用户名称",-1),J={key:0,class:"invalid-feedback feedback"},K={class:"form-floating"},Q=s("label",null,"用户密码",-1),W={key:0,class:"invalid-feedback feedback"},Y={class:"form-floating"},Z=s("label",null,"确认密码",-1),tt={key:0,class:"invalid-feedback feedback"},et=s("input",{type:"password",autocomplete:"new-password",style:{display:"none"}},null,-1),at={__name:"manager",setup(st){let p=I(),y={account:"",password:"",confirmPasswrod:"",state:l.ENABLE},o=M({users:[],radios:[{name:"type",value:l.ENABLE,label:"启用"},{name:"type",value:l.DISABLE,label:"禁用"}],isShowEdit:!1,user:a.clone(y),accountErrorMsg:"",pwdErrorMsg:"",conPwdErrorMsg:""});f.getUsers().then(({data:n})=>{let{items:t}=n;o.users=t.map(e=>(e.time=a.formatTime(e.created_time),e))});function g(n,t){o.isShowEdit=n,t&&(o.user=t),n||(o.user=a.clone(y))}function k(n){let t;a.isEqual(n.state,l.ENABLE)&&(t=l.DISABLE),a.isEqual(n.state,l.DISABLE)&&(t=l.ENABLE),f.disable({accounts:[n.account],is_disable:t}).then(()=>{o.users.map(e=>(a.isEqual(n.account,e.account)&&a.extend(e,{state:t}),e)),p.proxy.$toast({icon:"success",text:"操作成功",duration:4e3})})}function x(n){let t=o.users[n];f.remove({accounts:[t.account]}).then(()=>{o.users.splice(n,1),p.proxy.$toast({icon:"success",text:"删除成功",duration:4e3})})}function j(){let{user:n}=o,{account:t,password:e,confirmPasswrod:m}=n;if(a.isEmpty(t))return o.accountErrorMsg="账户名称不能为空";if(a.isEmpty(e))return o.pwdErrorMsg="密码不能为空";if(!a.isEqual(m,e))return o.conPwdErrorMsg="两次密码输入不一致";if(n.created_time)return f.updatePwd({account:t,password:e,new_password:m}).then(({code:c,msg:E})=>{a.isEqual(c,_.SUCCESS_0.code)?p.proxy.$toast({icon:"success",text:"修改密码成功",duration:3e3}):p.proxy.$toast({icon:"error",text:`${c}:${E}`,duration:3e3})});f.add({account:t,password:e,state:n.state}).then(({code:c})=>{let E="success",v="保存成功";a.isEqual(c,_.SUCCESS_0.code)?(n.time=a.formatTime(Date.now()),o.users.push(n),g(!1)):a.isEqual(c,_.USER_EXISTS.code)?(E="error",v=_.USER_EXISTS.msg):(E="error",v="保存失败，请重试"),p.proxy.$toast({icon:E,text:v,duration:4e3})})}function w(n){({account:()=>{o.accountErrorMsg=""},pwd:()=>{o.pwdErrorMsg=""},confirm:()=>{o.conPwdErrorMsg=""}})[n]()}return(n,t)=>(u(),d("div",P,[s("div",D,[N,s("div",{class:"jgicon jgicon-add jg-button jg-button-bg",onClick:t[0]||(t[0]=e=>g(!0))},"添加用户")]),s("table",T,[q,s("tbody",null,[(u(!0),d($,null,B(r(o).users,(e,m)=>(u(),d("tr",null,[s("td",null,i(e.account),1),s("td",null,i(e.account),1),V,s("td",{class:A(["jgicon",{"jgicon-success":e.state==r(l).ENABLE,"jgicon-error":e.state==r(l).DISABLE}])},i(e.state==r(l).ENABLE?"已启用":"已禁用"),3),s("td",null,i(e.time),1),s("td",R,[s("a",{class:"btn-link jg-btn-link",type:"button",onClick:c=>k(e)},i(e.state==r(l).DISABLE?"启用":"禁用"),9,F),s("a",{class:"btn-link jg-btn-link",type:"button",onClick:c=>x(m)},"删除",8,X)])]))),256))])]),C(L,{show:r(o).isShowEdit,title:"用户变更",onHide:t[7]||(t[7]=e=>g(!1)),onSave:t[8]||(t[8]=e=>j())},{default:U(()=>[s("div",z,[s("div",H,[b(s("input",{class:"form-control",disabled:r(o).user.created_time,"onUpdate:modelValue":t[1]||(t[1]=e=>r(o).user.account=e),type:"text",placeholder:"用户名称",autocomplete:"off",onInput:t[2]||(t[2]=e=>w("account"))},null,40,O),[[h,r(o).user.account]]),G,r(o).accountErrorMsg?(u(),d("div",J,i(r(o).accountErrorMsg),1)):S("",!0)]),s("div",K,[b(s("input",{class:"form-control","onUpdate:modelValue":t[3]||(t[3]=e=>r(o).user.password=e),type:"text",placeholder:"用户密码",onInput:t[4]||(t[4]=e=>w("pwd"))},null,544),[[h,r(o).user.password]]),Q,r(o).pwdErrorMsg?(u(),d("div",W,i(r(o).pwdErrorMsg),1)):S("",!0)]),s("div",Y,[b(s("input",{class:"form-control","onUpdate:modelValue":t[5]||(t[5]=e=>r(o).user.confirmPasswrod=e),type:"text",placeholder:"确认密码",onInput:t[6]||(t[6]=e=>w("confirm"))},null,544),[[h,r(o).user.confirmPasswrod]]),Z,r(o).conPwdErrorMsg?(u(),d("div",tt,i(r(o).conPwdErrorMsg),1)):S("",!0)]),et])]),_:1},8,["show"])]))}};export{at as default};
