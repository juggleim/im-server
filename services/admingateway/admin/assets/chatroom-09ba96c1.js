import{r as T,a6 as V,V as E,s as R,c as f,a as r,h as u,u as l,F as N,b as S,w as O,i as P,d as c,C as U,o as w,p as B,t as v,a7 as F,g as $}from"./index-a6509667.js";import{_ as C,c as m,A as G}from"./analysis-day-d980516b.js";const I={class:"mb-4 jg-as-box"},Y={class:"row jg-cb-row jg-as-header"},q={class:"jg-bk-form"},z={class:"row jg-asr-row"},H={class:"jg-as-tools"},L={class:"jg-as-tool"},W=["onClick"],J={class:"jg-as-date jgicon jgicon-date"},K=["onClick"],Q={class:"row jg-as-body"},X={class:"jg-bk-form",ref:"asuserchat"},st={__name:"chatroom",setup(Z){const M=$();let k=P(),{currentRoute:{_rawValue:{params:{app_key:g}}}}=k,a=T({buttons:V,range:{start:new Date(Date.now()-7*24*60*60*1e3),end:new Date},yestday:{upMsg:{percent:0,isUp:!0,count:0},downMsg:{percent:0,isUp:!0,count:0},disMsg:{percent:0,isUp:!0,count:0},online:{percent:0,isUp:!0,count:0}}}),p=null;function _(e){if(!p){let{asuserchat:d}=M.refs;p=M.proxy.$echat.init(d)}let{upMsgs:s,downMsgs:o,disMsgs:t,dates:i}=m.formatChatData(e);const n=["#5470C6","#008000","#EE6666"];let h={legend:{data:["聊天室上行消息量","聊天室下行消息量","聊天室分发消息量"]},tooltip:{trigger:"none",axisPointer:{type:"cross"}},xAxis:{type:"category",boundaryGap:!1,data:i},yAxis:{type:"value",axisPointer:{label:{formatter:function(d){return c.numberWithCommas(d.value.toFixed(0))}}}},series:[{name:"聊天室上行消息量",type:"line",smooth:!0,data:s,lineStyle:{color:n[0]}},{name:"聊天室下行消息量",type:"line",smooth:!0,lineStyle:{color:n[1]},data:o},{name:"聊天室分发消息量",type:"line",smooth:!0,lineStyle:{color:n[2]},data:t}]};p.setOption(h)}async function y(e){let{data:s}=await G.getMessageChat({...e,channel_type:F.CHATROOM}),{msg_dispatch:o={items:[]},msg_down:t={items:[]},msg_up:i={items:[]}}=s,n=(D,A)=>D.time_mark>A.time_mark,h=c.sort(o.items,n),d=c.sort(t.items,n),x=c.sort(i.items,n);return{disMsgs:h,downMsgs:d,upMsgs:x}}function j(e){return c.formatTime(new Date(e).getTime(),"yyyy-MM-dd")}async function b(e){c.map(a.buttons,n=>(n.isActive=c.isEqual(n.name,e.name),n));let{start:s,end:o}=m.getRangeDate(e.name),i=await y({app_key:g,start:s,end:o});_(i)}return E(()=>{let{start:e,end:s}=m.getRangeDate(7);y({app_key:g,start:e,end:s}).then(t=>{let i=m.calcYesterday(t);c.extend(a.yestday,i),_(t)})}),R(()=>a.range,async()=>{let{start:e,end:s}=a.range;e=new Date(e).getTime(),s=new Date(s).getTime();let t=await y({app_key:g,start:e,end:s});_(t)}),(e,s)=>{const o=U("VDatePicker");return w(),f("div",I,[r("div",Y,[r("div",q,[r("div",z,[u(C,{title:"昨日聊天室上行消息量（条）",item:l(a).yestday.upMsg},null,8,["item"]),u(C,{title:"昨日聊天室下行消息量（条）",item:l(a).yestday.downMsg},null,8,["item"]),u(C,{title:"昨日聊天室分发消息量（条）",item:l(a).yestday.disMsg},null,8,["item"])])])]),r("div",H,[r("div",L,[(w(!0),f(N,null,S(l(a).buttons,t=>(w(),f("div",{class:B(["jg-as-button",{"jg-as-button-active":t.isActive}]),onClick:i=>b(t)},v(t.title),11,W))),256)),r("div",J,[u(o,{modelValue:l(a).range,"onUpdate:modelValue":s[0]||(s[0]=t=>l(a).range=t),modelModifiers:{range:!0},class:"jg-as-date-picker"},{default:O(({togglePopover:t})=>[r("div",{class:"jg-as-date-content",onClick:t},v(j(l(a).range.start))+" 至 "+v(j(l(a).range.end)),9,K)]),_:1},8,["modelValue"])])])]),r("div",Q,[r("div",X,null,512)])])}}};export{st as default};
