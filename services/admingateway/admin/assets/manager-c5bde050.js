import{r as U,e as l,af as A,ag as a,c as d,b as s,F as M,d as $,u as n,k as I,w as D,_ as N,ah as P,i as w,o as u,t as i,x as h,p as b,v as k,q as x,C as q,h as T}from"./index-668b837b.js";import{U as E}from"./user-61c5e865.js";const V={class:"mb-4"},R={class:"header cim-header"},O={class:"table cim-table"},F={class:"cim-td-c cim-td-operate"},X=["onClick"],z=["onClick"],H={class:"row g-2 cim-row"},j={class:"form-floating"},G=["disabled"],J={key:0,class:"invalid-feedback feedback"},K={class:"form-floating"},Q={key:0,class:"invalid-feedback feedback"},W={class:"form-floating"},Y={key:0,class:"invalid-feedback feedback"},Z={class:"form-floating"},tt=["value"],nt={__name:"manager",setup(et){let c=T(),_={account:"",password:"",confirmPasswrod:"",state:a.ENABLE,role:P.ADMIN},o=U({users:[],roles:l.clone(A),radios:[{name:"type",value:a.ENABLE,label:"启用"},{name:"type",value:a.DISABLE,label:"禁用"}],isShowEdit:!1,user:l.clone(_),accountErrorMsg:"",pwdErrorMsg:"",conPwdErrorMsg:""});E.getUsers().then(({data:r})=>{let{items:t}=r;o.users=t.map(e=>(e.time=l.formatTime(e.created_time),e))});function S(r,t){o.isShowEdit=r,t&&(o.user=t),r||(o.user=l.clone(_))}function B(r){let t;l.isEqual(r.state,a.ENABLE)&&(t=a.DISABLE),l.isEqual(r.state,a.DISABLE)&&(t=a.ENABLE),E.disable({accounts:[r.account],is_disable:t}).then(()=>{o.users.map(e=>(l.isEqual(r.account,e.account)&&l.extend(e,{state:t}),e)),c.proxy.$toast({icon:"success",text:"操作成功",duration:4e3})})}function C(r){let t=o.users[r];E.remove({accounts:[t.account]}).then(()=>{o.users.splice(r,1),c.proxy.$toast({icon:"success",text:"删除成功",duration:4e3})})}function L(){let{user:r}=o,{account:t,password:e,confirmPasswrod:f,role:v}=r;if(l.isEmpty(t))return o.accountErrorMsg="账户名称不能为空";if(l.isEmpty(e))return o.pwdErrorMsg="密码不能为空";if(!l.isEqual(f,e))return o.conPwdErrorMsg="两次密码输入不一致";if(r.created_time)return E.updatePwd({account:t,password:e,new_password:f,role_id:v}).then(({code:p,msg:m})=>{l.isEqual(p,w.SUCCESS_0.code)?c.proxy.$toast({icon:"success",text:"修改密码成功",duration:3e3}):c.proxy.$toast({icon:"error",text:`${p}:${m}`,duration:3e3})});E.add({account:t,password:e,state:r.state,role_id:v}).then(({code:p})=>{let m="success",y="保存成功";l.isEqual(p,w.SUCCESS_0.code)?(r.time=l.formatTime(Date.now()),o.users.push(r),S(!1)):l.isEqual(p,w.USER_EXISTS.code)?(m="error",y=w.USER_EXISTS.msg):(m="error",y="保存失败，请重试"),c.proxy.$toast({icon:m,text:y,duration:4e3})})}function g(r){({account:()=>{o.accountErrorMsg=""},pwd:()=>{o.pwdErrorMsg=""},confirm:()=>{o.conPwdErrorMsg=""}})[r]()}return(r,t)=>(u(),d("div",V,[s("div",R,[t[10]||(t[10]=s("div",{class:"cim-title"},"用户管理",-1)),s("div",{class:"cicon cicon-add cim-button cim-button-bg",onClick:t[0]||(t[0]=e=>S(!0))},"添加用户")]),s("table",O,[t[12]||(t[12]=s("thead",null,[s("tr",null,[s("th",null,"用户名称"),s("th",null,"用户账号"),s("th",null,"用户密码"),s("th",null,"是否启用"),s("th",null,"创建时间"),s("th",{class:"cim-td-c"},"操作")])],-1)),s("tbody",null,[(u(!0),d(M,null,$(n(o).users,(e,f)=>(u(),d("tr",null,[s("td",null,i(e.account),1),s("td",null,i(e.account),1),t[11]||(t[11]=s("td",null,"**** ****",-1)),s("td",{class:h(["cicon",{"cicon-success":e.state==n(a).ENABLE,"cicon-error":e.state==n(a).DISABLE}])},i(e.state==n(a).ENABLE?"已启用":"已禁用"),3),s("td",null,i(e.time),1),s("td",F,[s("a",{class:"btn-link cim-btn-link",type:"button",onClick:v=>B(e)},i(e.state==n(a).DISABLE?"启用":"禁用"),9,X),s("a",{class:"btn-link cim-btn-link",type:"button",onClick:v=>C(f)},"删除",8,z)])]))),256))])]),I(N,{show:n(o).isShowEdit,title:"用户变更",onHide:t[8]||(t[8]=e=>S(!1)),onSave:t[9]||(t[9]=e=>L())},{default:D(()=>[s("div",H,[s("div",j,[b(s("input",{class:"form-control",disabled:n(o).user.created_time,"onUpdate:modelValue":t[1]||(t[1]=e=>n(o).user.account=e),type:"text",placeholder:"用户名称",autocomplete:"off",onInput:t[2]||(t[2]=e=>g("account"))},null,40,G),[[k,n(o).user.account]]),t[13]||(t[13]=s("label",null,"用户名称",-1)),n(o).accountErrorMsg?(u(),d("div",J,i(n(o).accountErrorMsg),1)):x("",!0)]),s("div",K,[b(s("input",{class:"form-control","onUpdate:modelValue":t[3]||(t[3]=e=>n(o).user.password=e),type:"text",placeholder:"用户密码",onInput:t[4]||(t[4]=e=>g("pwd"))},null,544),[[k,n(o).user.password]]),t[14]||(t[14]=s("label",null,"用户密码",-1)),n(o).pwdErrorMsg?(u(),d("div",Q,i(n(o).pwdErrorMsg),1)):x("",!0)]),s("div",W,[b(s("input",{class:"form-control","onUpdate:modelValue":t[5]||(t[5]=e=>n(o).user.confirmPasswrod=e),type:"text",placeholder:"确认密码",onInput:t[6]||(t[6]=e=>g("confirm"))},null,544),[[k,n(o).user.confirmPasswrod]]),t[15]||(t[15]=s("label",null,"确认密码",-1)),n(o).conPwdErrorMsg?(u(),d("div",Y,i(n(o).conPwdErrorMsg),1)):x("",!0)]),s("div",Z,[b(s("select",{class:"form-select","onUpdate:modelValue":t[7]||(t[7]=e=>n(o).user.role=e)},[(u(!0),d(M,null,$(n(o).roles,e=>(u(),d("option",{value:e.value},i(e.name),9,tt))),256))],512),[[q,n(o).user.role]]),t[16]||(t[16]=s("label",null,"用户角色",-1))]),t[17]||(t[17]=s("input",{type:"password",autocomplete:"new-password",style:{display:"none"}},null,-1))])]),_:1},8,["show"])]))}};export{nt as default};
