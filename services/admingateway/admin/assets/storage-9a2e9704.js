import{_ as T}from"./form-904dadb7.js";import{G as m,r as R,B as $,w as M,l as I,A as y,e as _,R as O,H as D,o,b as n,t as k,u as l,c as i,d as v,F as x,q as S,x as E,k as F,h as H}from"./index-668b837b.js";const P={class:"mb-4 app-base cim-cb-box"},W={class:"row cim-cb-row cim-cb-header"},z={class:"cim-cb-form cim-file-form"},G={class:"cim-cb-form-item"},L={class:"col-sm-7"},U={class:"warn"},j={class:"cim-cb-form-item"},J={class:"col-sm-4 store-form"},Q={class:"form-check-inline store_inline"},X=["value","checked"],Y={class:"form-check-label"},Z={key:0,class:"form-check-inline store_inline"},ee={class:"col-sm-3 cim-cb-btns"},te={class:"md-6"},ne={class:"nav nav-underline-border",role:"tablist"},ae=["onClick"],se={class:"tab-content rounded-bottom"},ie={__name:"storage",setup(le){let w=I(),b=H(),{currentRoute:{_rawValue:{params:{app_key:p}}}}=w,d=[{type:"aws",name:"AWS",state:m({access_key:"",secret_key:"",endpoint:"",region:"",bucket:""}),fields:[{name:"access_key",label:"Access Key",type:"input_text"},{name:"secret_key",label:"Secret Key",type:"input_text"},{name:"endpoint",label:"Endpoint",type:"input_text"},{name:"region",label:"Region",type:"input_text"},{name:"bucket",label:"Buket Name",type:"input_text"}]},{type:"qiniu",name:"七牛云",state:m({access_key:"",secret_key:"",bucket:""}),fields:[{name:"access_key",label:"Access Key",type:"input_text"},{name:"secret_key",label:"Secret Key",type:"input_text"},{name:"domain",label:"Domain Name",type:"input_text"},{name:"bucket",label:"Bucket Name",type:"input_text"}]},{type:"oss",name:"阿里云",state:m({access_key:"",secret_key:"",endpoint:"",bucket:""}),fields:[{name:"access_key",label:"Access Key",type:"input_text"},{name:"secret_key",label:"Secret Key",type:"input_text"},{name:"endpoint",label:"Endpoint",type:"input_text"},{name:"bucket",label:"Bucket name",type:"input_text"}]},{type:"minio",name:"MinIO",state:m({access_key:"",secret_key:"",endpoint:"",bucket:"",use_ssl:!1}),fields:[{name:"access_key",label:"Access Key",type:"input_text"},{name:"secret_key",label:"Secret Key",type:"input_text"},{name:"endpoint",label:"Endpoint",type:"input_text"},{name:"use_ssl",label:"启用 HTTPS",type:"radios",radios:[{name:"type",value:!1,label:"禁用"},{name:"type",value:!0,label:"启用"}]},{name:"bucket",label:"Buket Name",type:"input_text"}]}],e=R({checkedValue:{},current:"",channels:{oss:{name:"阿里云"},aws:{name:"AWS"},qiniu:{name:"七牛云"},minio:{name:"MinIO"}},fileConfs:[],formTitle:"添加配置"});const c=m(d[0].type);function B(a){c.value=a.type,g()}function C(){return e.fileConfs.find(t=>t.channel==c.value)}function A(a){let t=C();y.setStorageConfig({app_key:p,channel:c.value,conf:a}).then(()=>{let r=c.value,s=0,u=e.channels[r].name,h={channel:c,enable:s,name:u};if(!t)return e.fileConfs.push(h),b.proxy.$toast({icon:"success",text:"添加成功，请选择存储类型后，保存设置"});b.proxy.$toast({icon:"success",text:"修改成功，请选择存储类型后，保存设置"})})}async function g(){const a=await y.getStorageConfig({app_key:p,channel:c.value});_.forEach(d,t=>{t.type===c.value&&a.data&&a.data.conf&&(t.state.value={...t.state.value,...a.data.conf})}),e.formTitle=C()?"修改配置":"添加配置"}g();function K(a){let t=a.target.value;e.checkedValue.value=t}function N(){y.getEnableStorage({app_key:p}).then(a=>{let{code:t,data:r={}}=a;if(_.isEqual(t,O.SUCCESS)){let{file_confs:s}=r,u={channel:""},h=_.map(s,f=>{let q=e.channels[f.channel]||{name:""};return f.enable&&(u=f),{...f,name:q.name}});e.current=u.channel,e.fileConfs=h}})}function V(){let a=e.checkedValue.value;y.setEnableStorage({app_key:p,channel:a}).then(()=>{e.current=a,b.proxy.$toast({icon:"success",text:"保存成功"})})}return N(),(a,t)=>{const r=D("n-flex");return o(),$(r,{vertical:""},{default:M(()=>[n("div",P,[n("div",W,[n("div",z,[n("div",G,[t[0]||(t[0]=n("label",{class:"col-sm-1 col-form-label cim-form-item-label"}," 正在使用存储 ",-1)),n("div",L,[n("span",U,k(l(e).channels[l(e).current]&&l(e).channels[l(e).current].name||"未设置"),1)])]),n("div",j,[t[2]||(t[2]=n("label",{class:"col-sm-1 col-form-label"}," 设置存储类型 ",-1)),n("div",J,[(o(!0),i(x,null,v(l(e).fileConfs,s=>(o(),i("div",Q,[n("input",{class:"form-check-input",type:"radio",name:"setting.name",value:s.channel,checked:s.enable,onChange:K},null,40,X),n("label",Y,k(s.name),1)]))),256)),l(e).fileConfs.length==0?(o(),i("div",Z,t[1]||(t[1]=[n("span",{class:"warn fs-12"},"请优先添加文件存储配置",-1)]))):S("",!0)]),n("div",ee,[l(e).fileConfs.length>0?(o(),i("div",{key:0,class:"cim-button cim-button-bg warn-bg",onClick:V},"保存设置")):S("",!0)])])])])]),n("div",te,[n("ul",ne,[(o(!0),i(x,null,v(l(d),s=>(o(),i("li",{class:"nav-item sw-nav-item",onClick:u=>B(s)},[n("a",{class:E(["nav-link cicon cicon-free",{active:l(_).isEqual(c.value,s.type)}])}," 添加 "+k(s.name)+" 配置",3)],8,ae))),256))]),n("div",se,[(o(!0),i(x,null,v(l(d),s=>(o(),i("div",{class:E(["tab-pane p-3",{active:l(_).isEqual(c.value,s.type)}])},[F(T,{fields:s.fields,state:s.state.value,"btn-type":1,title:l(e).formTitle,onSave:A},null,8,["fields","state","title"])],2))),256))])])]),_:1})}}};export{ie as default};
